#!/usr/bin/env bash

# change to the project root
DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$DIR"/.. || exit

docker container run \
  --rm -it \
  -v "$(pwd)":/app \
  -w /app/client \
  node:lts yarn install --frozen-lockfile

if [ "$1" == "prod" ]
then
    # if prod, only deploy services in docker-compose.yml file
    docker compose -f docker-compose.yml build \
      && docker compose -f docker-compose.yml up -d "$@" \
      && docker compose -f docker-compose.yml logs -f
else
    docker compose build \
      && docker compose up -d "$@" \
      && docker compose logs -f
fi